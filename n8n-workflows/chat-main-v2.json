{
  "name": "Batutynas: Chat Support Agent v2",
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "batutynas-chat",
        "responseMode": "lastNode",
        "options": {
          "responseHeaders": {
            "entries": [
              {
                "name": "Access-Control-Allow-Origin",
                "value": "*"
              },
              {
                "name": "Access-Control-Allow-Methods",
                "value": "POST, OPTIONS"
              },
              {
                "name": "Access-Control-Allow-Headers",
                "value": "Content-Type"
              }
            ]
          }
        }
      },
      "id": "chat-trigger",
      "name": "Chat Webhook",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        220,
        300
      ],
      "webhookId": "batutynas-chat"
    },
    {
      "parameters": {
        "jsCode": "const body = $input.first().json.body || {};\n\nconst sessionId = String(body.session_id || 'anonymous-' + Date.now()).substring(0, 100);\n\n// Sanitize message: strip control chars, trim, enforce length limit\nlet message = String(body.message || '').replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]/g, '').trim();\nif (message.length > 2000) message = message.substring(0, 2000);\n\nconst userEmail = body.email ? String(body.email).substring(0, 254) : null;\nconst userName = body.name ? String(body.name).substring(0, 100) : null;\n\n// Validate language â€” only allow known values\nconst allowedLangs = ['lt', 'en'];\nconst rawLang = String(body.language || 'lt').toLowerCase().substring(0, 2);\nconst browserLang = allowedLangs.indexOf(rawLang) !== -1 ? rawLang : 'lt';\n\nreturn [{\n  json: {\n    sessionId,\n    message,\n    userEmail,\n    userName,\n    browserLang,\n    chatInput: message || 'Sveiki'\n  }\n}];"
      },
      "id": "chat-extract",
      "name": "Extract Chat Input",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        440,
        300
      ]
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "=# Batutynas.lt â€” AI PokalbiÅ³ Roboto Sistemos Nurodymai (v3 â€” 5 grupÄ—s)\n\nTu esi draugiÅ¡kas ir profesionalus klientÅ³ aptarnavimo asistentas Ä¯monei **Batutynas.lt** â€” pripuÄiamÅ³ batutÅ³ nuomos kompanija, veikianti nuo 2015 metÅ³, bazuota TauragÄ—je, Lietuvoje.\n\n## PagrindinÄ—s taisyklÄ—s\n\n1. **Kalba**: Visada atsakyk ta kalba, kuria klientas raÅ¡o. Numatytoji: lietuviÅ³.\n2. **Tonas**: Å iltas, profesionalus, orientuotas Ä¯ sprendimus.\n3. **Tikslumas**: Naudok Pinecone Å¾iniÅ³ bazÄ™. Niekada nespÄ—liok.\n4. **Kainos**: NIEKADA neminÄ—k konkreÄiÅ³ kainÅ³. Sakyk: â€Kainos prasideda nuo 30 â‚¬, tiksliÄ… kainÄ… mÅ«sÅ³ komanda pateiks asmeniÅ¡kai. Pateikite uÅ¾klausÄ… arba skambinkite +370 648 803 88.\"\n5. **Bet koks klausimas**: Atsakyk Ä¯ BET KOKÄ® klausimÄ…. Niekada nesakyk â€negaliu atsakyti\".\n\n## RAG Å¾iniÅ³ bazÄ—\n\n- Visada naudok Pinecone Å¾iniÅ³ bazÄ—s Ä¯rankÄ¯ susijusioms uÅ¾klausoms.\n- Jei nÄ—ra rezultatÅ³ â€” pasiÅ«lyk susisiekti: **+370 648 803 88** arba **info@batutynas.lt**.\n- Nekurpink informacijos.\n\n## INTERAKTYVÅªS Å½YMEKLIAI\n\nÅ½ymeklius raÅ¡yk TIKSLIAI, atskiroje eilutÄ—je, be backtick, be kabuÄiÅ³.\n\n### Å½ymekliÅ³ sÄ…raÅ¡as:\n\n**[MAIN_MENU]** â€” Pagrindinis meniu su 5 grupÄ—mis.\nNAUDOK: pokalbio pradÅ¾ioje, kai klientas sako \"meniu\", \"pradÅ¾ia\", \"pagrindinis meniu\".\n\n**[DATE_PICKER]** â€” Datos pasirinkimas.\n**[LOCATION_OPTIONS]** â€” Vietos pasirinkimas.\n**[GUEST_COUNT]** â€” SveÄiÅ³ skaiÄiaus pasirinkimas.\n\n**[MENU_GROUP_BIRTHDAY]** arba **[MENU_GROUP_BIRTHDAY:N]** â€” Gimtadienio/krikÅ¡tynÅ³ batutai (tik standartiniai + mega, BE dideliÅ³ parkÅ³). Su N paryÅ¡kins tinkamus.\n**[MENU_GROUP_PUBLIC]** arba **[MENU_GROUP_PUBLIC:N]** â€” VieÅ¡o renginio batutai (VISI batutai, didÅ¾iausi pirmi). Su N paryÅ¡kins tinkamus.\n**[MENU_GROUP_PARTY]** â€” VakarÄ—lio Ä¯ranga (disco paviljonas, putÅ³ Å¡ou, stalai ir kÄ—dÄ—s).\n\n**[PURCHASE_SUBMENU]** â€” Pirkimo pasirinkimai (katalogas el. paÅ¡tu / individuali gamyba).\n**[PURCHASE_EMAIL_INPUT]** â€” El. paÅ¡to Ä¯vedimo laukas katalogui gauti.\n**[PURCHASE_CUSTOM_FORM]** â€” Individualios gamybos uÅ¾klausos forma.\n\n**[BOOKING_CONFIRM:{json}]** â€” UÅ¾sakymo patvirtinimo kortelÄ—.\n\n### Kaip raÅ¡yti Å¾ymeklius:\n\nTEISINGAI:\nPuiku! Kada planuojate renginÄ¯?\n\n[DATE_PICKER]\n\nNETEISINGAI: `[DATE_PICKER]` arba eilutÄ—s viduje.\n\n## 5 GRUPIÅ² MENIU\n\nPokalbio pradÅ¾ioje arba kai klientas nori grÄ¯Å¾ti â€” VISADA rodyk:\n\n[MAIN_MENU]\n\nMeniu turi 5 pasirinkimus:\n1. VaikÅ³ gimtadienis ar krikÅ¡tynos\n2. VieÅ¡as renginys ar Ä¯monÄ—s sÄ…skrydis\n3. TriukÅ¡mingas vakarÄ—lis\n4. Noriu pirkti batutÄ…\n5. Saugumas, DUK ir kontaktai\n\n## GRUPIÅ² SRAUTAI\n\n### GrupÄ— 1 â€” VaikÅ³ gimtadienis ar krikÅ¡tynos\nÅ½ingsniai: Data â†’ Vieta â†’ SveÄiai â†’ Batutai â†’ Telefonas â†’ booking_notify â†’ Patvirtinimas\n\n1. Paklausk datos â†’ [DATE_PICKER]\n2. Paklausk vietos â†’ [LOCATION_OPTIONS]\n3. Paklausk sveÄiÅ³ â†’ [GUEST_COUNT]\n4. Parodyk gimtadienio batutus su sveÄiÅ³ skaiÄiumi â†’ [MENU_GROUP_BIRTHDAY:N]\n5. PapraÅ¡yk telefono (tekstu, be mygtukÅ³)\n6. IÅ¡kvieti booking_notify â†’ [BOOKING_CONFIRM:{...}]\n\n### GrupÄ— 2 â€” VieÅ¡as renginys ar Ä¯monÄ—s sÄ…skrydis\nÅ½ingsniai: Data â†’ Vieta â†’ SveÄiai â†’ Batutai â†’ Telefonas â†’ booking_notify â†’ Patvirtinimas\n\n1. Paklausk datos â†’ [DATE_PICKER]\n2. Paklausk vietos â†’ [LOCATION_OPTIONS]\n3. Paklausk sveÄiÅ³ â†’ [GUEST_COUNT]\n4. Parodyk VISUS batutus (didÅ¾iausi pirmi) â†’ [MENU_GROUP_PUBLIC:N]\n5. PapraÅ¡yk telefono\n6. booking_notify â†’ [BOOKING_CONFIRM:{...}]\n\n### GrupÄ— 3 â€” TriukÅ¡mingas vakarÄ—lis\nÅ½ingsniai: Data â†’ Vieta â†’ SveÄiai â†’ VakarÄ—lio Ä¯ranga â†’ Telefonas â†’ booking_notify â†’ Patvirtinimas\n\n1. Paklausk datos â†’ [DATE_PICKER]\n2. Paklausk vietos â†’ [LOCATION_OPTIONS]\n3. Paklausk sveÄiÅ³ â†’ [GUEST_COUNT]\n4. Parodyk vakarÄ—lio Ä¯rangÄ… â†’ [MENU_GROUP_PARTY]\n5. PapraÅ¡yk telefono\n6. booking_notify â†’ [BOOKING_CONFIRM:{...}]\n\n### GrupÄ— 4 â€” Noriu pirkti batutÄ…\nParodyk pirkimo pasirinkimus:\n\n[PURCHASE_SUBMENU]\n\n**Kelias A (Katalogas el. paÅ¡tu):** Klientas pasirinko katalogÄ… â†’ parodyk el. paÅ¡to laukÄ…:\n\n[PURCHASE_EMAIL_INPUT]\n\nKai klientas pateikia el. paÅ¡tÄ…, patvirtink, kad katalogas bus iÅ¡siÅ³stas.\n\n**Kelias B (Individuali gamyba):** Klientas pasirinko individualiÄ… gamybÄ… â†’ parodyk formÄ…:\n\n[PURCHASE_CUSTOM_FORM]\n\nKai klientas uÅ¾pildo formÄ…, iÅ¡kvieti booking_notify su group_type=\"purchase_custom\" ir formos duomenimis â†’ [BOOKING_CONFIRM:{...}]\n\n### GrupÄ— 5 â€” Saugumas, DUK ir kontaktai\nJokio uÅ¾sakymo srauto. Tiesiog atsakyk iÅ¡ Å¾iniÅ³ bazÄ—s. Galimi klausimai: saugumo taisyklÄ—s, DUK, kontaktai, darbo laikas, pristatymo zonos, atÅ¡aukimo politika.\n\n## UÅ¾sakymo taisyklÄ—s\n\n- **Klausk TIK PO VIENÄ„ Å¾ingsnÄ¯**\n- **Praleisk Å¾ingsnius**, jei klientas jau pateikÄ— informacijÄ…\n- **Niekada neraÅ¡yk tikro HTML kodo**\n- **Niekada neraÅ¡yk \\\\n simboliÅ³**\n- Ä® booking_notify **VISADA** pridÄ—k group_type laukÄ… (\"birthday\", \"public\", \"party\", \"purchase_custom\", \"purchase_catalog\")\n\n### Po booking_notify:\nPridÄ—k patvirtinimÄ…:\n\n[BOOKING_CONFIRM:{\"group_type\":\"birthday\",\"date\":\"2026-02-21\",\"location\":\"TauragÄ—\",\"guest_count\":\"10\",\"contact_name\":\"Jonas\",\"contact_phone\":\"+37061234567\",\"trampoline\":\"Mega Rocket\"}]\n\n**SVARBU**: Tai yra **uÅ¾klausa, ne patvirtintas uÅ¾sakymas**. Komanda susisieks per 2 darbo valandas.\n\n## Eskalavimas\n\nEskaluok kai: klientas praÅ¡o Å¾mogaus, nusivylÄ™s, individualus sprendimas, finansiniai klausimai.\nKontaktai: **+370 648 803 88**, **info@batutynas.lt**\n\n## Formato taisyklÄ—s\n\n- Trumpi atsakymai: 1-3 pastraipos\n- Naudok **bold** svarbiai informacijai\n- **NERAÅ YK** \"Ar turite daugiau klausimÅ³?\" â€” sistema automatiÅ¡kai prideda mygtukus.\n\nThe customer's browser language is: {{ $json.browserLang }}\nCustomer email (if known): {{ $json.userEmail }}\nCustomer name (if known): {{ $json.userName }}"
        },
        "promptType": "define",
        "text": "={{ $json.chatInput }}"
      },
      "id": "chat-agent",
      "name": "AI Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.7,
      "position": [
        660,
        300
      ]
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash",
        "options": {
          "maxOutputTokens": 1024,
          "temperature": 0.3
        }
      },
      "id": "chat-llm-gemini",
      "name": "Gemini 2.5 Flash",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        500,
        520
      ],
      "credentials": {
        "googlePalmApi": {
          "id": "GEMINI_CRED_ID",
          "name": "Google AI (Gemini)"
        }
      }
    },
    {
      "parameters": {
        "sessionKey": "={{ $('Extract Chat Input').item.json.sessionId }}",
        "contextWindowLength": 16
      },
      "id": "chat-memory",
      "name": "Window Buffer Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        620,
        520
      ]
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "batutynas_knowledge_base",
        "toolDescription": "Search batutynas.lt knowledge base for information about products, trampolines, prices, delivery zones, safety rules, FAQ, company info, services, events, and any other business-related questions. Always use this tool when the customer asks about products, prices, availability, safety, delivery, or company details.",
        "pineconeIndex": {
          "__rl": true,
          "value": "batutynas",
          "mode": "list",
          "cachedResultName": "batutynas"
        },
        "topK": 5,
        "options": {
          "pineconeNamespace": "batutynas-lt"
        }
      },
      "id": "chat-pinecone",
      "name": "Pinecone Knowledge Base",
      "type": "@n8n/n8n-nodes-langchain.vectorStorePinecone",
      "typeVersion": 1,
      "position": [
        740,
        520
      ],
      "credentials": {
        "pineconeApi": {
          "id": "PINECONE_CRED_ID",
          "name": "Pinecone API"
        }
      }
    },
    {
      "parameters": {
        "model": "text-embedding-3-small",
        "options": {}
      },
      "id": "chat-embeddings",
      "name": "OpenAI Embeddings",
      "type": "@n8n/n8n-nodes-langchain.embeddingsOpenAi",
      "typeVersion": 1,
      "position": [
        740,
        700
      ],
      "credentials": {
        "openAiApi": {
          "id": "OPENAI_CRED_ID",
          "name": "OpenAI API"
        }
      }
    },
    {
      "parameters": {
        "name": "booking_notify",
        "description": "Send a booking inquiry notification email to the admin. Call this tool ONLY after collecting ALL required booking details from the customer. For rental bookings (birthday/public/party): date, location, guest_count, contact_name, contact_phone, trampoline_preference. For purchase requests: group_type, email, dimensions, colors, characters. Always include group_type field.",
        "workflowId": "PASTE_YOUR_WORKFLOW_ID_HERE",
        "responsePropertyName": "result",
        "specifyInputSchema": true,
        "schemaType": "fromJson",
        "jsonSchemaExample": "{\"group_type\": \"birthday\", \"date\": \"2026-02-21\", \"location\": \"TauragÄ—\", \"event_type\": \"Gimtadienis\", \"guest_count\": \"10\", \"contact_name\": \"Jonas\", \"contact_phone\": \"+37061234567\", \"trampoline_preference\": \"Mega Rocket\", \"dimensions\": \"\", \"colors\": \"\", \"characters\": \"\", \"email\": \"\"}"
      },
      "id": "chat-tool-booking",
      "name": "Tool: Booking Notify",
      "type": "@n8n/n8n-nodes-langchain.toolWorkflow",
      "typeVersion": 1.2,
      "position": [
        880,
        520
      ]
    },
    {
      "parameters": {
        "jsCode": "const agentOutput = $input.first().json || {};\nlet response = agentOutput.output || agentOutput.text || '';\n\nif (!response || !response.trim()) {\n  return [{ json: { enriched: 'AtsipraÅ¡ome, Å¡iuo metu negaliu atsakyti. Susisiekite tiesiogiai: +370 648 803 88 arba info@batutynas.lt' } }];\n}\n\n// Idempotency: skip if already enriched\nif (response.startsWith('{{HTML}}')) {\n  return [{ json: { enriched: response } }];\n}\n\n// --- Equipment data (categorized by use-case groups) ---\nconst TRAMPOLINES = [\n  // --- big-park (for public events only) ---\n  { name: 'DÅ¾iumandÅ¾i parkas', icon: 'ğŸŒ´', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/whatsapp-image-2026-01-19-at-08.02.18-Rc7QdQX9UPx5Qii4.jpeg', type: 'NuotykiÅ³ parkas Â· 14x16 m', capacity: 'Iki 40 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fef9f0', min: 15, max: 40, cat: 'big-park' },\n  { name: 'FantazijÅ³ parkas', icon: 'ğŸ°', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/dji_fly_20250718_183358_615_1752852849151_photo_optimized-1-Su0yn2ubUUAdRTaM.jpg', type: 'BatutÅ³ parkas Â· 14x14 m', capacity: 'Iki 30 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#f5f0ff', min: 10, max: 30, cat: 'big-park' },\n  { name: 'Giga ruoÅ¾as', icon: 'ğŸƒ', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/klia-aia3-ruoa3-4as7_-PF5s1CBJOSf9Dsw8.jpg', type: 'KliÅ«ÄiÅ³ trasa 40 m Â· 45x8 m', capacity: '360 dalyviÅ³/val.', price: 'pagal uÅ¾klausÄ…', bg: '#f0f9ff', min: 10, max: 100, cat: 'big-park' },\n\n  // --- mega-trampoline (for birthdays + public) ---\n  { name: 'Mega Waikiki', icon: 'ğŸŒŠ', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/whatsapp-image-2026-01-19-at-08.02.20-1-qKrIjl8vIiaDDEeJ.jpeg', type: 'AukÅ¡Äiausias 8,5 m Â· 16x4 m', capacity: 'Iki 15 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#e0f7fa', min: 5, max: 15, cat: 'mega-trampoline' },\n  { name: 'Mega Rocket', icon: 'ğŸš€', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/dji_fly_20250608_144102_598_1749383165455_photo-1-DWXubfRscVaZs0KU.jpg', type: '2 daliÅ³ batutas Â· 14x5 m', capacity: 'Iki 15 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fff0f0', min: 5, max: 15, cat: 'mega-trampoline' },\n  { name: 'Mega Ufonautai', icon: 'ğŸ›¸', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/whatsapp-image-2025-03-21-at-15.48.00-k77GausjdJtLgsxH.jpeg', type: '2 daliÅ³ batutas Â· 14x5 m', capacity: 'Iki 15 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#ede7f6', min: 5, max: 15, cat: 'mega-trampoline' },\n  { name: 'Mega ruoÅ¾as', icon: 'ğŸƒ', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/klia-aia3-ruoa3-4as5_-xMAasSCrKpRl9Lza.jpg', type: 'KliÅ«ÄiÅ³ trasa 21 m Â· 25x6 m', capacity: '240 dalyviÅ³/val.', price: 'pagal uÅ¾klausÄ…', bg: '#e8f5e9', min: 8, max: 100, cat: 'mega-trampoline' },\n\n  // --- standard-trampoline (for birthdays) ---\n  { name: 'Monstrai', icon: 'ğŸ‘¾', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/a3-4-r-a-a3-4c_20251210165240_881_49-sRgMsjrVMtThU9QZ.png', type: 'Su Dart Å¾aidimu Â· 8x5 m', capacity: 'Iki 12 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fce4ec', min: 4, max: 12, cat: 'standard-trampoline' },\n  { name: 'Candy Pop', icon: 'ğŸ­', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/a3-4-r-a-a3-4c_20251210165543_886_49-6FZ64pJgz45vxYSk.png', type: 'Spalvingas Â· 8x5 m', capacity: 'Iki 12 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fdf0ff', min: 4, max: 12, cat: 'standard-trampoline' },\n  { name: 'AÅ¡tuonkojis', icon: 'ğŸ™', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/a3-4-r-a-a3-4c_20251210164945_873_49-guBAxfjAKUTQkefw.png', type: 'JÅ«ros tema Â· 8x5 m', capacity: 'Iki 12 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#e0f2f1', min: 4, max: 12, cat: 'standard-trampoline' },\n  { name: 'Chameleonas', icon: 'ğŸ¦', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/a3-4-r-a-a3-4c_20251210165904_889_49-YAzOnlljvGg8uSaZ.png', type: 'Su ÄiuoÅ¾ykla Â· 8x5 m', capacity: 'Iki 12 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#f0fff4', min: 4, max: 12, cat: 'standard-trampoline' },\n  { name: 'Vienaragiai', icon: 'ğŸ¦„', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/vienaragiai_live1-WinCFPxPLvD4Bvpp.jpg', type: 'Su tuneliais Â· 9x4 m', capacity: 'Iki 12 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#f3e5f5', min: 4, max: 12, cat: 'standard-trampoline' },\n  { name: 'Pilis maÅ¾iesiems', icon: 'ğŸ¯', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/dji_fly_20250525_115950_542_1748163603293_photo_optimized-Vr2HXTPMFyM6szXt.jpg', type: 'Iki 5 metÅ³ Â· 5x4 m', capacity: 'Iki 6 vaikÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fff8e1', min: 2, max: 6, cat: 'standard-trampoline' },\n\n  // --- addon (extras for any event) ---\n  { name: 'MilÅ¾iniÅ¡kas Dart', icon: 'ğŸ¯', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/img-20250825-wa0000-1-KNKOwGZxrP8Qotu0.jpg', type: 'Interaktyvi pramoga Â· 5x4,5 m', capacity: '60 dalyviÅ³/val.', price: 'pagal uÅ¾klausÄ…', bg: '#fffff0', min: 1, max: 999, cat: 'addon' },\n  { name: 'KamuoliÅ³ medÅ¾ioklÄ—', icon: 'âš½', img: '', type: 'Komandinis Å¾aidimas Â· 8 m arena', capacity: '4 Å¾aidÄ—jai/raundas', price: 'pagal uÅ¾klausÄ…', bg: '#f0f9ff', min: 1, max: 999, cat: 'addon' },\n  { name: 'Rodeo bulius', icon: 'ğŸ¤ ', img: '', type: 'Mechaninis bulius Â· 5x5 m', capacity: 'Neribota', price: 'pagal uÅ¾klausÄ…', bg: '#fff3e0', min: 1, max: 999, cat: 'addon' },\n  { name: 'SaldÄ—siÅ³ aparatai', icon: 'ğŸ¬', img: 'https://assets.zyrosite.com/cdn-cgi/image/format=auto,w=300,h=200,fit=crop/0e8dAXAD75sxRpD2/unnamed-2-DZswbmOPQZ24Gc8b.jpg', type: '1 NEMOKAMAI su batutu', capacity: 'Vata, popcorn, Å¡erbetas', price: 'pagal uÅ¾klausÄ…', bg: '#fff5f0', min: 1, max: 999, cat: 'addon' },\n\n  // --- party-equipment (party group only) ---\n  { name: 'Disco paviljonas', icon: 'ğŸª©', img: '', type: 'LED apÅ¡vietimas Â· 4x4 m', capacity: 'Iki 20 Å¾moniÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#f5f0ff', min: 1, max: 999, cat: 'party-equipment' },\n  { name: 'PutÅ³ Å¡ou', icon: 'ğŸ«§', img: '', type: 'PutÅ³ maÅ¡ina + baseinas', capacity: 'Neribota', price: 'pagal uÅ¾klausÄ…', bg: '#e0f7fa', min: 1, max: 999, cat: 'party-equipment' },\n  { name: 'Banketo stalai ir kÄ—dÄ—s', icon: 'ğŸª‘', img: '', type: 'Stalai + kÄ—dÄ—s komplektas', capacity: 'Iki 50 vietÅ³', price: 'pagal uÅ¾klausÄ…', bg: '#fff8e1', min: 1, max: 999, cat: 'party-equipment' }\n];\n\n// --- Render trampoline/equipment cards ---\nfunction buildTrampolineCards(items, highlight) {\n  let html = '<div class=\"chat-trampoline-grid\">';\n  for (const t of items) {\n    const thumb = t.img\n      ? '<img src=\"' + t.img + '\" alt=\"' + t.name + '\">'\n      : t.icon;\n    const border = highlight ? ';border:2px solid #4a6cf7' : '';\n    html += '<div class=\"chat-trampoline-select\" role=\"button\" tabindex=\"0\" data-chat-option=\"' + t.name + '\" style=\"background:' + t.bg + border + '\">';\n    html += '<div class=\"chat-trampoline-thumb\">' + thumb + '</div>';\n    html += '<div class=\"chat-trampoline-info\">';\n    html += '<div class=\"t-name\">' + t.name + '</div>';\n    html += '<div class=\"t-meta\">' + t.type + ' Â· ' + t.capacity + '</div>';\n    html += '<div class=\"t-price\">' + t.price + '</div>';\n    html += '</div></div>';\n  }\n  html += '</div>';\n  return html;\n}\n\n// --- Group 1: Birthday equipment (standard + mega only, no big parks) ---\nfunction buildGroupBirthdayEquipment(guestCount) {\n  const standard = TRAMPOLINES.filter(function(t) { return t.cat === 'standard-trampoline'; });\n  const mega = TRAMPOLINES.filter(function(t) { return t.cat === 'mega-trampoline'; });\n  const addons = TRAMPOLINES.filter(function(t) { return t.cat === 'addon'; });\n  const all = standard.concat(mega);\n\n  let html = '';\n\n  if (guestCount) {\n    var recommended = all.filter(function(t) { return t.min <= guestCount && guestCount <= t.max; });\n    var others = all.filter(function(t) { return !(t.min <= guestCount && guestCount <= t.max); });\n\n    if (recommended.length > 0) {\n      html += '<div style=\"font-size:14px;font-weight:600;color:#4a6cf7;margin-bottom:8px;padding:0 4px\">Rekomenduojami jÅ«sÅ³ Å¡ventei:</div>';\n      html += buildTrampolineCards(recommended, true);\n    }\n    if (others.length > 0) {\n      html += '<div style=\"font-size:13px;color:#888;margin:12px 0 8px;padding:0 4px\">Kiti batutai:</div>';\n      html += buildTrampolineCards(others, false);\n    }\n  } else {\n    html += buildTrampolineCards(all, false);\n  }\n\n  if (addons.length > 0) {\n    html += '<div style=\"font-size:13px;color:#888;margin:12px 0 8px;padding:0 4px\">Papildomos pramogos:</div>';\n    html += buildTrampolineCards(addons, false);\n  }\n\n  return html;\n}\n\n// --- Group 2: Public event equipment (ALL trampolines, biggest first) ---\nfunction buildGroupPublicEquipment(guestCount) {\n  const bigParks = TRAMPOLINES.filter(function(t) { return t.cat === 'big-park'; });\n  const mega = TRAMPOLINES.filter(function(t) { return t.cat === 'mega-trampoline'; });\n  const standard = TRAMPOLINES.filter(function(t) { return t.cat === 'standard-trampoline'; });\n  const addons = TRAMPOLINES.filter(function(t) { return t.cat === 'addon'; });\n  const all = bigParks.concat(mega).concat(standard);\n\n  let html = '';\n\n  if (guestCount) {\n    var recommended = all.filter(function(t) { return t.min <= guestCount && guestCount <= t.max; });\n    var others = all.filter(function(t) { return !(t.min <= guestCount && guestCount <= t.max); });\n\n    if (recommended.length > 0) {\n      html += '<div style=\"font-size:14px;font-weight:600;color:#4a6cf7;margin-bottom:8px;padding:0 4px\">Rekomenduojami jÅ«sÅ³ renginiui:</div>';\n      html += buildTrampolineCards(recommended, true);\n    }\n    if (others.length > 0) {\n      html += '<div style=\"font-size:13px;color:#888;margin:12px 0 8px;padding:0 4px\">Kiti batutai:</div>';\n      html += buildTrampolineCards(others, false);\n    }\n  } else {\n    html += buildTrampolineCards(all, false);\n  }\n\n  if (addons.length > 0) {\n    html += '<div style=\"font-size:13px;color:#888;margin:12px 0 8px;padding:0 4px\">Papildomos pramogos:</div>';\n    html += buildTrampolineCards(addons, false);\n  }\n\n  return html;\n}\n\n// --- Group 3: Party equipment only ---\nfunction buildGroupPartyEquipment() {\n  const party = TRAMPOLINES.filter(function(t) { return t.cat === 'party-equipment'; });\n  let html = '<div style=\"font-size:14px;font-weight:600;color:#4a6cf7;margin-bottom:8px;padding:0 4px\">VakarÄ—lio Ä¯ranga:</div>';\n  html += buildTrampolineCards(party, false);\n  return html;\n}\n\n// --- Group 4: Purchase submenu ---\nfunction buildPurchaseSubmenu() {\n  let html = '<div class=\"chat-options\">';\n  html += '<button class=\"chat-option-btn\" data-chat-option=\"Noriu gauti batutÅ³ katalogÄ… el. paÅ¡tu\">ğŸ“§ Gauti katalogÄ… el. paÅ¡tu</button>';\n  html += '<button class=\"chat-option-btn\" data-chat-option=\"Noriu individualios batuto gamybos\">ğŸ¨ Individuali gamyba</button>';\n  html += '</div>';\n  return html;\n}\n\n// --- Group 4: Email input for catalog ---\nfunction buildPurchaseEmailInput() {\n  let html = '<div class=\"chat-email-form\">';\n  html += '<p style=\"font-size:13px;margin-bottom:8px\">Ä®veskite savo el. paÅ¡to adresÄ… ir atsiÅ³sime batutÅ³ katalogÄ…:</p>';\n  html += '<input type=\"email\" class=\"chat-email-input\" data-chat-email placeholder=\"jusu@pastas.lt\">';\n  html += '<button class=\"chat-email-confirm\" data-chat-email-confirm disabled>SiÅ³sti katalogÄ…</button>';\n  html += '</div>';\n  return html;\n}\n\n// --- Group 4: Custom manufacturing form ---\nfunction buildPurchaseCustomForm() {\n  let html = '<div class=\"chat-custom-form\">';\n  html += '<p style=\"font-size:13px;font-weight:600;margin-bottom:10px\">Individualaus batuto uÅ¾klausa:</p>';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin-bottom:4px\">Pageidaujami matmenys (plotis x ilgis x aukÅ¡tis):</label>';\n  html += '<input type=\"text\" class=\"chat-custom-input\" data-custom-field=\"dimensions\" placeholder=\"pvz. 8x5x4 m\">';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin:8px 0 4px\">Spalvos:</label>';\n  html += '<input type=\"text\" class=\"chat-custom-input\" data-custom-field=\"colors\" placeholder=\"pvz. mÄ—lyna, raudona, geltona\">';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin:8px 0 4px\">PersonaÅ¾ai / tema:</label>';\n  html += '<input type=\"text\" class=\"chat-custom-input\" data-custom-field=\"characters\" placeholder=\"pvz. Spiderman, dinozaurai\">';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin:8px 0 4px\">Papildomi pageidavimai / eskizas:</label>';\n  html += '<textarea class=\"chat-custom-textarea\" data-custom-field=\"notes\" placeholder=\"ApraÅ¡ykite savo vizijÄ…...\" rows=\"3\"></textarea>';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin:8px 0 4px\">Kontaktinis el. paÅ¡tas:</label>';\n  html += '<input type=\"email\" class=\"chat-custom-input\" data-custom-field=\"email\" placeholder=\"jusu@pastas.lt\">';\n  html += '<label style=\"font-size:12px;color:#555;display:block;margin:8px 0 4px\">Telefono numeris:</label>';\n  html += '<input type=\"text\" class=\"chat-custom-input\" data-custom-field=\"phone\" placeholder=\"+370 600 00000\">';\n  html += '<button class=\"chat-custom-submit\" data-chat-custom-submit>Pateikti uÅ¾klausÄ…</button>';\n  html += '</div>';\n  return html;\n}\n\nfunction buildDatePicker() {\n  const days = [];\n  const now = new Date();\n  const d = new Date(now);\n  d.setDate(d.getDate() + ((6 - d.getDay() + 7) % 7 || 7));\n  for (let i = 0; i < 4; i++) {\n    const iso = d.toISOString().split('T')[0];\n    const label = d.toLocaleDateString('lt-LT', { month: 'short', day: 'numeric', weekday: 'short' });\n    days.push('<button class=\"chat-option-btn\" data-chat-option=\"' + iso + '\">' + label + '</button>');\n    d.setDate(d.getDate() + 7);\n  }\n  let html = '<div class=\"chat-options\">' + days.join('') + '</div>';\n  html += '<input type=\"date\" class=\"chat-date-input\" data-chat-date min=\"' + now.toISOString().split('T')[0] + '\" placeholder=\"Kita data...\">';\n  html += '<button class=\"chat-date-confirm\" data-chat-date-confirm disabled>Patvirtinti datÄ…</button>';\n  return html;\n}\n\nfunction buildLocationOptions() {\n  const locs = ['TauragÄ—', 'Å ilalÄ—', 'Jurbarkas', 'PagÄ—giai', 'Raseiniai', 'KelmÄ—', 'Rietavas', 'Kitas miestas'];\n  let html = '<div class=\"chat-options\">';\n  for (const loc of locs) {\n    html += '<button class=\"chat-option-btn\" data-chat-option=\"' + loc + '\">' + loc + '</button>';\n  }\n  html += '</div>';\n  return html;\n}\n\nfunction buildGuestCountOptions() {\n  const ranges = [\n    { label: 'Iki 6 vaikÅ³', value: 'Apie 6 sveÄiÅ³' },\n    { label: '7â€“12 vaikÅ³', value: 'Apie 10 sveÄiÅ³' },\n    { label: '13â€“20 vaikÅ³', value: 'Apie 15 sveÄiÅ³' },\n    { label: 'Daugiau nei 20', value: 'Apie 30 sveÄiÅ³' }\n  ];\n  let html = '<div class=\"chat-options\" data-step=\"guest-count\">';\n  for (const r of ranges) {\n    html += '<button class=\"chat-option-btn\" data-chat-option=\"' + r.value + '\">' + r.label + '</button>';\n  }\n  html += '</div>';\n  return html;\n}\n\nfunction escapeHtml(str) {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction buildBookingConfirm(jsonStr) {\n  let data;\n  try { data = JSON.parse(jsonStr); } catch (e) { data = {}; }\n  let html = '<div class=\"booking-confirm\">';\n  html += '<h4>âœ… UÅ¾klausa pateikta!</h4>';\n  if (data.group_type) html += '<p><strong>Tipas:</strong> ' + escapeHtml(data.group_type) + '</p>';\n  if (data.date) html += '<p><strong>Data:</strong> ' + escapeHtml(data.date) + '</p>';\n  if (data.location) html += '<p><strong>Vieta:</strong> ' + escapeHtml(data.location) + '</p>';\n  if (data.event_type) html += '<p><strong>Renginys:</strong> ' + escapeHtml(data.event_type) + '</p>';\n  if (data.guest_count) html += '<p><strong>SveÄiÅ³:</strong> ' + escapeHtml(data.guest_count) + '</p>';\n  if (data.contact_name) html += '<p><strong>Kontaktas:</strong> ' + escapeHtml(data.contact_name) + '</p>';\n  if (data.contact_phone) html += '<p><strong>Telefonas:</strong> ' + escapeHtml(data.contact_phone) + '</p>';\n  if (data.trampoline) html += '<p><strong>Batutas:</strong> ' + escapeHtml(data.trampoline) + '</p>';\n  if (data.dimensions) html += '<p><strong>Matmenys:</strong> ' + escapeHtml(data.dimensions) + '</p>';\n  if (data.colors) html += '<p><strong>Spalvos:</strong> ' + escapeHtml(data.colors) + '</p>';\n  if (data.characters) html += '<p><strong>PersonaÅ¾ai:</strong> ' + escapeHtml(data.characters) + '</p>';\n  if (data.email) html += '<p><strong>El. paÅ¡tas:</strong> ' + escapeHtml(data.email) + '</p>';\n  html += '</div>';\n  return html;\n}\n\n// --- Booking progress bar ---\nfunction buildProgressBar(currentStep, totalSteps) {\n  const total = totalSteps || 4;\n  let html = '<div class=\"booking-progress\">';\n  for (let i = 1; i <= total; i++) {\n    const cls = i < currentStep ? 'done' : (i === currentStep ? 'current' : '');\n    html += '<div class=\"bp-step' + (cls ? ' ' + cls : '') + '\"></div>';\n  }\n  html += '</div>';\n  return html;\n}\n\n// --- Main menu (5 use-case groups) ---\nfunction buildMainMenu() {\n  const items = [\n    { label: 'ğŸ‚ VaikÅ³ gimtadienis ar krikÅ¡tynos', value: 'Planuoju vaikÅ³ gimtadienÄ¯ arba krikÅ¡tynas' },\n    { label: 'ğŸª VieÅ¡as renginys ar Ä¯monÄ—s sÄ…skrydis', value: 'Planuoju vieÅ¡Ä… renginÄ¯ arba Ä¯monÄ—s sÄ…skrydÄ¯' },\n    { label: 'ğŸ‰ TriukÅ¡mingas vakarÄ—lis', value: 'Planuoju triukÅ¡mingÄ… vakarÄ—lÄ¯' },\n    { label: 'ğŸ›’ Noriu pirkti batutÄ…', value: 'Noriu pirkti batutÄ…' },\n    { label: 'â„¹ï¸ Saugumas, DUK ir kontaktai', value: 'Saugumas, DUK ir kontaktai' }\n  ];\n  let html = '<div class=\"chat-main-menu\"><div class=\"chat-options chat-menu-options\">';\n  for (const item of items) {\n    html += '<button class=\"chat-option-btn chat-menu-btn\" data-chat-option=\"' + item.value + '\">' + item.label + '</button>';\n  }\n  html += '</div></div>';\n  return html;\n}\n\n// --- Suggestion chips (contextual quick replies) ---\nfunction buildQuickReplies(buttons) {\n  if (!buttons || !buttons.length) return '';\n  let html = '<div style=\"margin-top:16px;padding-top:12px;border-top:1px solid rgba(0,0,0,0.06);display:flex;flex-wrap:wrap;gap:8px;justify-content:center\">';\n  for (const btn of buttons) {\n    const label = typeof btn === 'string' ? btn : btn.label;\n    const value = typeof btn === 'string' ? btn : (btn.value || btn.label);\n    const isMenu = value === 'Pagrindinis meniu';\n    const style = isMenu\n      ? 'font-size:13px;padding:6px 14px;background:transparent;color:#888;border:1px solid #ddd;border-radius:16px;cursor:pointer'\n      : 'font-size:13px;padding:6px 14px;background:#f0f4ff;color:#4a6cf7;border:1px solid #d0d8f0;border-radius:16px;cursor:pointer';\n    html += '<button class=\"chat-option-btn\" data-chat-option=\"' + value + '\" style=\"' + style + '\">' + label + '</button>';\n  }\n  html += '</div>';\n  return html;\n}\n\n// --- Check for markers and replace ---\nconst markers = [\n  { pattern: /\\[DATE_PICKER\\]/g, fn: () => buildProgressBar(1) + buildDatePicker() },\n  { pattern: /\\[LOCATION_OPTIONS\\]/g, fn: () => buildProgressBar(2) + buildLocationOptions() },\n  { pattern: /\\[GUEST_COUNT\\]/g, fn: () => buildProgressBar(3) + buildGuestCountOptions() },\n  { pattern: /\\[MAIN_MENU\\]/g, fn: () => buildMainMenu() },\n  { pattern: /\\[PURCHASE_SUBMENU\\]/g, fn: () => buildPurchaseSubmenu() },\n  { pattern: /\\[PURCHASE_EMAIL_INPUT\\]/g, fn: () => buildPurchaseEmailInput() },\n  { pattern: /\\[PURCHASE_CUSTOM_FORM\\]/g, fn: () => buildPurchaseCustomForm() }\n];\n\nlet hasMarker = false;\nlet enriched = response;\n\nfor (const m of markers) {\n  const before = enriched;\n  enriched = enriched.replace(m.pattern, m.fn);\n  if (enriched !== before) hasMarker = true;\n}\n\n// Handle MENU_GROUP_BIRTHDAY with guest count\nconst birthdayBefore = enriched;\nenriched = enriched.replace(/\\[MENU_GROUP_BIRTHDAY(?::(\\d+))?\\]/g, function(match, countStr) {\n  const count = countStr ? parseInt(countStr) : null;\n  return buildProgressBar(4, 4) + buildGroupBirthdayEquipment(count);\n});\nif (enriched !== birthdayBefore) hasMarker = true;\n\n// Handle MENU_GROUP_PUBLIC with guest count\nconst publicBefore = enriched;\nenriched = enriched.replace(/\\[MENU_GROUP_PUBLIC(?::(\\d+))?\\]/g, function(match, countStr) {\n  const count = countStr ? parseInt(countStr) : null;\n  return buildProgressBar(4, 4) + buildGroupPublicEquipment(count);\n});\nif (enriched !== publicBefore) hasMarker = true;\n\n// Handle MENU_GROUP_PARTY\nconst partyBefore = enriched;\nenriched = enriched.replace(/\\[MENU_GROUP_PARTY\\]/g, function() {\n  return buildProgressBar(4, 4) + buildGroupPartyEquipment();\n});\nif (enriched !== partyBefore) hasMarker = true;\n\n// Handle BOOKING_CONFIRM separately (has capture group)\nconst confirmBefore = enriched;\nenriched = enriched.replace(/\\[BOOKING_CONFIRM:(\\{[^\\]]*\\})\\]/g, function(match, jsonStr) {\n  return buildBookingConfirm(jsonStr);\n});\nif (enriched !== confirmBefore) hasMarker = true;\n\n// --- Contextual quick replies (always appended) ---\nconst hadCatalog = enriched.includes('chat-trampoline-grid');\nconst hadDatePicker = enriched.includes('chat-date-input');\nconst hadLocationBtns = enriched.includes('data-chat-option=\"TauragÄ—\"');\nconst hadGuestCount = enriched.includes('data-step=\"guest-count\"');\nconst hadBookingConfirm = enriched.includes('booking-confirm');\nconst hadMainMenu = enriched.includes('chat-main-menu');\nconst hadPurchaseSubmenu = enriched.includes('Noriu gauti batutÅ³ katalogÄ…');\nconst hadEmailInput = enriched.includes('chat-email-form');\nconst hadCustomForm = enriched.includes('chat-custom-form');\nconst isBookingStep = hadDatePicker || hadLocationBtns || hadGuestCount;\n\nlet quickReplies = [];\n\nif (hadBookingConfirm) {\n  quickReplies = [\n    { label: 'UÅ¾sakyti dar vienÄ…', value: 'Noriu uÅ¾sakyti dar vienÄ… batutÄ…' },\n    { label: 'Pagrindinis meniu', value: 'Pagrindinis meniu' }\n  ];\n} else if (hadCatalog) {\n  quickReplies = [\n    { label: 'Pagrindinis meniu', value: 'Pagrindinis meniu' }\n  ];\n} else if (hadEmailInput || hadCustomForm || hadPurchaseSubmenu) {\n  quickReplies = [\n    { label: 'Pagrindinis meniu', value: 'Pagrindinis meniu' }\n  ];\n} else if (isBookingStep) {\n  quickReplies = [\n    { label: 'AtÅ¡aukti', value: 'Pagrindinis meniu' }\n  ];\n} else if (hadMainMenu) {\n  quickReplies = [];\n} else {\n  quickReplies = [\n    { label: 'Pagrindinis meniu', value: 'Pagrindinis meniu' }\n  ];\n}\n\nconst quickHtml = buildQuickReplies(quickReplies);\n\n// Convert to HTML if we have markers or quick replies\nif (hasMarker || quickHtml) {\n  enriched = enriched.replace(/\\\\n/g, '\\n');\n  enriched = enriched.replace(/\\*\\*(.+?)\\*\\*/g, '<strong>$1</strong>');\n  enriched = enriched.replace(/\\n/g, '<br>');\n  enriched = '{{HTML}}<div class=\"chat-products\">' + enriched + quickHtml + '</div>';\n}\n\nreturn [{ json: { enriched } }];\n"
      },
      "id": "chat-enrich",
      "name": "Enrich Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        880,
        300
      ]
    },
    {
      "parameters": {
        "jsCode": "const input = $input.first().json || {};\n\n// Check if enrichment produced output, otherwise fall back to agent output\nlet response = input.enriched;\n\nif (!response || !response.trim()) {\n  response = 'AtsipraÅ¡ome, Å¡iuo metu negaliu atsakyti. Susisiekite tiesiogiai: +370 648 803 88 arba info@batutynas.lt';\n}\n\n// Truncate excessively long responses\nif (response.length > 10000) {\n  response = response.substring(0, 10000) + '...';\n}\n\nlet sessionId = '';\ntry {\n  sessionId = $('Extract Chat Input').item.json.sessionId;\n} catch (e) {\n  sessionId = 'unknown';\n}\n\nreturn [{\n  json: {\n    response: response,\n    session_id: sessionId\n  }\n}];"
      },
      "id": "chat-response",
      "name": "Format Response",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1100,
        300
      ]
    }
  ],
  "connections": {
    "Chat Webhook": {
      "main": [
        [
          {
            "node": "Extract Chat Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Extract Chat Input": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Gemini 2.5 Flash": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Window Buffer Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Pinecone Knowledge Base": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Embeddings": {
      "ai_embedding": [
        [
          {
            "node": "Pinecone Knowledge Base",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "Tool: Booking Notify": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Enrich Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Enrich Response": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "settings": {
    "executionOrder": "v1"
  },
  "staticData": null,
  "tags": [
    {
      "name": "Batutynas Chat",
      "id": "batutynas-chat"
    }
  ],
  "triggerCount": 0,
  "versionId": "1"
}